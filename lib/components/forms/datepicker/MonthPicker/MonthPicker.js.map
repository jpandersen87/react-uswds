{"version":3,"file":"MonthPicker.js","sources":["../../../../../libSrc/components/forms/datepicker/MonthPicker/MonthPicker.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, type KeyboardEvent } from 'react'\nimport classnames from 'classnames'\n\nimport {\n  isDatesMonthOutsideMinOrMax,\n  isSameMonth,\n  keepDateBetweenMinAndMax,\n  listToTable,\n  setMonth,\n  handleTabKey,\n  isIosDevice,\n} from '../utils.js'\n\nimport { type DatePickerLocalization, EN_US } from '../i18n.js'\n\nexport type MonthPickerProps = {\n  date: Date\n  minDate: Date\n  maxDate?: Date\n  handleSelectMonth: (value: number) => void\n  i18n?: DatePickerLocalization\n}\n\nconst MonthPicker = ({\n  date,\n  minDate,\n  maxDate,\n  handleSelectMonth,\n  i18n = EN_US,\n}: MonthPickerProps): React.ReactElement => {\n  const selectedMonth = date.getMonth()\n  const [monthToDisplay, setMonthToDisplay] = useState(selectedMonth)\n  const monthPickerEl = useRef<HTMLDivElement>(null)\n  const focusedMonthEl = useRef<HTMLButtonElement>(null)\n\n  useEffect(() => {\n    const monthToFocus =\n      monthPickerEl.current &&\n      monthPickerEl.current.querySelector<HTMLButtonElement>(\n        `[data-value=\"${monthToDisplay}\"]`\n      )\n    if (monthToFocus) monthToFocus.focus()\n  }, [monthToDisplay])\n\n  const handleMonthPickerTab = (event: KeyboardEvent): void => {\n    handleTabKey(event, [focusedMonthEl?.current])\n  }\n\n  const handleKeyDownFromMonth = (event: KeyboardEvent): void => {\n    let newDisplayMonth\n    const target = event.target as HTMLButtonElement\n    const selectedMonth = parseInt(target.dataset?.value || '', 10)\n    const currentDate = setMonth(date, selectedMonth)\n\n    switch (event.key) {\n      case 'ArrowUp':\n      case 'Up':\n        newDisplayMonth = selectedMonth - 3\n        break\n      case 'ArrowDown':\n      case 'Down':\n        newDisplayMonth = selectedMonth + 3\n        break\n      case 'ArrowLeft':\n      case 'Left':\n        newDisplayMonth = selectedMonth - 1\n        break\n      case 'ArrowRight':\n      case 'Right':\n        newDisplayMonth = selectedMonth + 1\n        break\n      case 'Home':\n        newDisplayMonth = selectedMonth - (selectedMonth % 3)\n        break\n      case 'End':\n        newDisplayMonth = selectedMonth + 2 - (selectedMonth % 3)\n        break\n      case 'PageDown':\n        newDisplayMonth = 11\n        break\n      case 'PageUp':\n        newDisplayMonth = 0\n        break\n      default:\n        return\n    }\n\n    if (newDisplayMonth !== undefined) {\n      newDisplayMonth = Math.max(0, Math.min(11, newDisplayMonth))\n      const newDate = setMonth(date, newDisplayMonth)\n      const cappedDate = keepDateBetweenMinAndMax(newDate, minDate, maxDate)\n      if (!isSameMonth(currentDate, cappedDate)) {\n        setMonthToDisplay(cappedDate.getMonth())\n      }\n    }\n\n    event.preventDefault()\n  }\n\n  const monthNames = i18n.months\n\n  const months = monthNames.map((month, index) => {\n    const monthToCheck = setMonth(date, index)\n    const isDisabled = isDatesMonthOutsideMinOrMax(\n      monthToCheck,\n      minDate,\n      maxDate\n    )\n    const isSelected = index === selectedMonth\n    const isFocused = index === monthToDisplay\n\n    const tabIndex = isFocused ? 0 : -1\n\n    const classes = classnames('usa-date-picker__calendar__month', {\n      'usa-date-picker__calendar__month--selected': isSelected,\n      'usa-date-picker__calendar__month--focused': isFocused,\n    })\n\n    const onClick = (): void => {\n      handleSelectMonth(index)\n    }\n\n    const handleMouseMoveFromMonth = (): void => {\n      if (isDisabled || isIosDevice()) return\n      if (index === monthToDisplay) return\n      setMonthToDisplay(index)\n    }\n\n    return (\n      // Ignoring error: \"The attribute aria-selected is not supported by the role button. This role is implicit on the element button.\"\n      // Ignoring because this attribute is present in the USWDS implementation (https://github.com/uswds/uswds/blob/develop/src/js/components/date-picker.js#L1340)\n      // eslint-disable-next-line jsx-a11y/role-supports-aria-props\n      <button\n        type=\"button\"\n        key={`selectMonth_${month}`}\n        ref={isFocused ? focusedMonthEl : null}\n        tabIndex={tabIndex}\n        className={classes}\n        data-value={index}\n        data-label={month}\n        aria-selected={isSelected}\n        disabled={isDisabled}\n        onClick={onClick}\n        onKeyDown={handleKeyDownFromMonth}\n        onMouseMove={handleMouseMoveFromMonth}>\n        {month}\n      </button>\n    )\n  })\n\n  return (\n    // Ignoring error: \"Static HTML elements with event handlers require a role.\"\n    // Ignoring because this element does not have a role in the USWDS implementation (https://github.com/uswds/uswds/blob/develop/src/js/components/date-picker.js#L1345)\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      tabIndex={-1}\n      data-testid=\"calendar-month-picker\"\n      className=\"usa-date-picker__calendar__month-picker\"\n      ref={monthPickerEl}\n      onKeyDown={handleMonthPickerTab}>\n      <table className=\"usa-date-picker__calendar__table\" role=\"presentation\">\n        <tbody>{listToTable(months, 3)}</tbody>\n      </table>\n    </div>\n  )\n}\n\nexport default MonthPicker\n"],"names":["MonthPicker","date","minDate","maxDate","handleSelectMonth","i18n","EN_US","selectedMonth","monthToDisplay","setMonthToDisplay","useState","monthPickerEl","useRef","focusedMonthEl","useEffect","monthToFocus","handleMonthPickerTab","event","handleTabKey","handleKeyDownFromMonth","newDisplayMonth","target","_a","currentDate","setMonth","newDate","cappedDate","keepDateBetweenMinAndMax","isSameMonth","months","month","index","monthToCheck","isDisabled","isDatesMonthOutsideMinOrMax","isSelected","isFocused","tabIndex","classes","classnames","jsx","isIosDevice","listToTable"],"mappings":";;;;;AAuBA,MAAMA,IAAc,CAAC;AAAA,EACnB,MAAAC;AAAA,EACA,SAAAC;AAAA,EACA,SAAAC;AAAA,EACA,mBAAAC;AAAA,EACA,MAAAC,IAAOC;AACT,MAA4C;AACpC,QAAAC,IAAgBN,EAAK,YACrB,CAACO,GAAgBC,CAAiB,IAAIC,EAASH,CAAa,GAC5DI,IAAgBC,EAAuB,IAAI,GAC3CC,IAAiBD,EAA0B,IAAI;AAErD,EAAAE,EAAU,MAAM;AACd,UAAMC,IACJJ,EAAc,WACdA,EAAc,QAAQ;AAAA,MACpB,gBAAgBH,CAAc;AAAA,IAAA;AAE9B,IAAAO,KAAcA,EAAa,MAAM;AAAA,EAAA,GACpC,CAACP,CAAc,CAAC;AAEb,QAAAQ,IAAuB,CAACC,MAA+B;AAC3D,IAAAC,EAAaD,GAAO,CAACJ,KAAA,gBAAAA,EAAgB,OAAO,CAAC;AAAA,EAAA,GAGzCM,IAAyB,CAACF,MAA+B;;AACzD,QAAAG;AACJ,UAAMC,IAASJ,EAAM,QACfV,IAAgB,WAASe,IAAAD,EAAO,YAAP,gBAAAC,EAAgB,UAAS,IAAI,EAAE,GACxDC,IAAcC,EAASvB,GAAMM,CAAa;AAEhD,YAAQU,EAAM,KAAK;AAAA,MACjB,KAAK;AAAA,MACL,KAAK;AACH,QAAAG,IAAkBb,IAAgB;AAClC;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AACH,QAAAa,IAAkBb,IAAgB;AAClC;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AACH,QAAAa,IAAkBb,IAAgB;AAClC;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AACH,QAAAa,IAAkBb,IAAgB;AAClC;AAAA,MACF,KAAK;AACH,QAAAa,IAAkBb,IAAiBA,IAAgB;AACnD;AAAA,MACF,KAAK;AACeA,QAAAA,IAAAA,IAAgB,IAAKA,IAAgB;AACvD;AAAA,MACF,KAAK;AACe,QAAAa,IAAA;AAClB;AAAA,MACF,KAAK;AACe,QAAAA,IAAA;AAClB;AAAA,MACF;AACE;AAAA,IACJ;AAEA,QAAIA,MAAoB,QAAW;AACjC,MAAAA,IAAkB,KAAK,IAAI,GAAG,KAAK,IAAI,IAAIA,CAAe,CAAC;AACrD,YAAAK,IAAUD,EAASvB,GAAMmB,CAAe,GACxCM,IAAaC,EAAyBF,GAASvB,GAASC,CAAO;AACrE,MAAKyB,EAAYL,GAAaG,CAAU,KACpBjB,EAAAiB,EAAW,UAAU;AAAA,IAE3C;AAEA,IAAAT,EAAM,eAAe;AAAA,EAAA,GAKjBY,IAFaxB,EAAK,OAEE,IAAI,CAACyB,GAAOC,MAAU;AACxC,UAAAC,IAAeR,EAASvB,GAAM8B,CAAK,GACnCE,IAAaC;AAAA,MACjBF;AAAA,MACA9B;AAAA,MACAC;AAAA,IAAA,GAEIgC,IAAaJ,MAAUxB,GACvB6B,IAAYL,MAAUvB,GAEtB6B,IAAWD,IAAY,IAAI,IAE3BE,IAAUC,EAAW,oCAAoC;AAAA,MAC7D,8CAA8CJ;AAAA,MAC9C,6CAA6CC;AAAA,IAAA,CAC9C;AAYD;AAAA;AAAA;AAAA;AAAA,MAIE,gBAAAI;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAK;AAAA,UAEL,KAAKJ,IAAYvB,IAAiB;AAAA,UAClC,UAAAwB;AAAA,UACA,WAAWC;AAAA,UACX,cAAYP;AAAA,UACZ,cAAYD;AAAA,UACZ,iBAAeK;AAAA,UACf,UAAUF;AAAA,UACV,SAxBY,MAAY;AAC1B,YAAA7B,EAAkB2B,CAAK;AAAA,UAAA;AAAA,UAwBrB,WAAWZ;AAAA,UACX,aAtB6B,MAAY;AAC3C,YAAIc,KAAcQ,EAAY,KAC1BV,MAAUvB,KACdC,EAAkBsB,CAAK;AAAA,UAAA;AAAA,UAoBpB,UAAAD;AAAA,QAAA;AAAA,QAXI,eAAeA,CAAK;AAAA,MAY3B;AAAA;AAAA,EAAA,CAEH;AAED;AAAA;AAAA;AAAA;AAAA,IAIE,gBAAAU;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,UAAU;AAAA,QACV,eAAY;AAAA,QACZ,WAAU;AAAA,QACV,KAAK7B;AAAA,QACL,WAAWK;AAAA,QACX,UAAC,gBAAAwB,EAAA,SAAA,EAAM,WAAU,oCAAmC,MAAK,gBACvD,UAAC,gBAAAA,EAAA,SAAA,EAAO,UAAYE,EAAAb,GAAQ,CAAC,EAAE,CAAA,GACjC;AAAA,MAAA;AAAA,IACF;AAAA;AAEJ;"}