{"version":3,"file":"YearPicker.js","sources":["../../../../../libSrc/components/forms/datepicker/YearPicker/YearPicker.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, type KeyboardEvent } from 'react'\nimport classnames from 'classnames'\n\nimport { YEAR_CHUNK } from '../constants.js'\nimport {\n  isDatesYearOutsideMinOrMax,\n  keepDateBetweenMinAndMax,\n  listToTable,\n  setYear,\n  isSameYear,\n  handleTabKey,\n  isIosDevice,\n} from '../utils.js'\n\nexport interface YearPickerProps {\n  date: Date\n  minDate: Date\n  maxDate?: Date\n  handleSelectYear: (year: number) => void\n  setStatuses: (statuses: string[]) => void\n}\n\nconst YearPicker = ({\n  date,\n  minDate,\n  maxDate,\n  handleSelectYear,\n  setStatuses,\n}: YearPickerProps): React.ReactElement => {\n  const prevYearChunkEl = useRef<HTMLButtonElement>(null)\n  const nextYearChunkEl = useRef<HTMLButtonElement>(null)\n  const focusedYearEl = useRef<HTMLButtonElement>(null)\n  const yearPickerEl = useRef<HTMLDivElement>(null)\n\n  const selectedYear = date.getFullYear()\n\n  const [yearToDisplay, setYearToDisplay] = useState(selectedYear)\n  const [nextToFocus, setNextToFocus] = useState<\n    [HTMLButtonElement | null, HTMLDivElement | null]\n  >([null, null])\n\n  let yearToChunk = yearToDisplay\n  yearToChunk -= yearToChunk % YEAR_CHUNK\n  yearToChunk = Math.max(0, yearToChunk)\n\n  const prevYearChunkDisabled = isDatesYearOutsideMinOrMax(\n    setYear(date, yearToChunk - 1),\n    minDate,\n    maxDate\n  )\n  const nextYearChunkDisabled = isDatesYearOutsideMinOrMax(\n    setYear(date, yearToChunk + YEAR_CHUNK),\n    minDate,\n    maxDate\n  )\n\n  useEffect(() => {\n    // update status text when year chunk changes\n    const statusStr = `Showing years ${yearToChunk} to ${\n      yearToChunk + YEAR_CHUNK - 1\n    }. Select a year.`\n    setStatuses([statusStr])\n\n    // also focus on next element\n    const [focusEl, fallbackFocusEl] = nextToFocus\n\n    if (focusEl && fallbackFocusEl) {\n      if (focusEl.disabled) {\n        fallbackFocusEl.focus()\n      } else {\n        focusEl.focus()\n      }\n      setNextToFocus([null, null])\n    } else {\n      // Focus on the new year when it changes\n      const focusedYear =\n        yearPickerEl.current &&\n        yearPickerEl.current.querySelector<HTMLElement>(\n          '.usa-date-picker__calendar__year--focused'\n        )\n      if (focusedYear) {\n        focusedYear.focus()\n      }\n    }\n  }, [yearToDisplay])\n\n  useEffect(() => {\n    // focus on year button on mount\n    const yearToFocus =\n      yearPickerEl.current &&\n      yearPickerEl.current.querySelector<HTMLButtonElement>(\n        `[data-value=\"${yearToDisplay}\"]`\n      )\n    if (yearToFocus) yearToFocus.focus()\n  }, [])\n\n  const handleYearPickerTab = (event: KeyboardEvent): void => {\n    handleTabKey(event, [\n      prevYearChunkEl?.current,\n      focusedYearEl?.current,\n      nextYearChunkEl?.current,\n    ])\n  }\n\n  const handleKeyDownFromYear = (event: KeyboardEvent): void => {\n    let newDisplayYear\n    const target = event.target as HTMLButtonElement\n    const focusedYear = parseInt(target.dataset?.value || '', 10)\n    const currentDate = setYear(date, focusedYear)\n\n    switch (event.key) {\n      case 'ArrowUp':\n      case 'Up':\n        newDisplayYear = focusedYear - 3\n        break\n      case 'ArrowDown':\n      case 'Down':\n        newDisplayYear = focusedYear + 3\n        break\n      case 'ArrowLeft':\n      case 'Left':\n        newDisplayYear = focusedYear - 1\n        break\n      case 'ArrowRight':\n      case 'Right':\n        newDisplayYear = focusedYear + 1\n        break\n      case 'Home':\n        newDisplayYear = focusedYear - (focusedYear % 3)\n        break\n      case 'End':\n        newDisplayYear = focusedYear + 2 - (focusedYear % 3)\n        break\n      case 'PageDown':\n        newDisplayYear = focusedYear + YEAR_CHUNK\n        break\n      case 'PageUp':\n        newDisplayYear = focusedYear - YEAR_CHUNK\n        break\n      default:\n        return\n    }\n\n    if (newDisplayYear !== undefined) {\n      newDisplayYear = Math.max(0, newDisplayYear)\n      const newDate = setYear(date, newDisplayYear)\n      const cappedDate = keepDateBetweenMinAndMax(newDate, minDate, maxDate)\n      if (!isSameYear(currentDate, cappedDate)) {\n        setYearToDisplay(cappedDate.getFullYear())\n      }\n    }\n\n    event.preventDefault()\n  }\n\n  const years = []\n  let yearIndex = yearToChunk\n  while (years.length < YEAR_CHUNK) {\n    const yearIterator = yearIndex\n    const isDisabled = isDatesYearOutsideMinOrMax(\n      setYear(date, yearIterator),\n      minDate,\n      maxDate\n    )\n\n    const isSelected = yearIterator === selectedYear\n    const isFocused = yearIterator === yearToDisplay\n    const tabIndex = isFocused ? 0 : -1\n\n    const classes = classnames('usa-date-picker__calendar__year', {\n      'usa-date-picker__calendar__year--selected': isSelected,\n      'usa-date-picker__calendar__year--focused': isFocused,\n    })\n\n    const onClick = (): void => {\n      handleSelectYear(yearIterator)\n    }\n\n    const handleMouseMoveFromYear = (): void => {\n      if (isDisabled || isIosDevice()) return\n      if (yearIterator === yearToDisplay) return\n      setYearToDisplay(yearIterator)\n    }\n\n    years.push(\n      // Ignoring error: \"The attribute aria-selected is not supported by the role button. This role is implicit on the element button.\"\n      // Ignoring because this attribute is present in the USWDS implementation (https://github.com/uswds/uswds/blob/develop/src/js/components/date-picker.js#L1447)\n      // eslint-disable-next-line jsx-a11y/role-supports-aria-props\n      <button\n        type=\"button\"\n        tabIndex={tabIndex}\n        ref={isFocused ? focusedYearEl : null}\n        className={classes}\n        data-value={yearIterator}\n        aria-selected={isSelected}\n        disabled={isDisabled}\n        onClick={onClick}\n        onKeyDown={handleKeyDownFromYear}\n        onMouseMove={handleMouseMoveFromYear}>\n        {yearIterator}\n      </button>\n    )\n\n    yearIndex += 1\n  }\n\n  const handlePreviousYearChunkClick = (): void => {\n    let adjustedYear = yearToDisplay - YEAR_CHUNK\n    adjustedYear = Math.max(0, adjustedYear)\n\n    let newDate = setYear(date, adjustedYear)\n    newDate = keepDateBetweenMinAndMax(newDate, minDate, maxDate)\n    setNextToFocus([prevYearChunkEl.current, yearPickerEl.current])\n    setYearToDisplay(newDate.getFullYear())\n  }\n\n  const handleNextYearChunkClick = (): void => {\n    let adjustedYear = yearToDisplay + YEAR_CHUNK\n    adjustedYear = Math.max(0, adjustedYear)\n\n    let newDate = setYear(date, adjustedYear)\n    newDate = keepDateBetweenMinAndMax(newDate, minDate, maxDate)\n    setNextToFocus([nextYearChunkEl.current, yearPickerEl.current])\n    setYearToDisplay(newDate.getFullYear())\n  }\n\n  return (\n    // Ignoring error: \"Static HTML elements with event handlers require a role.\"\n    // Ignoring because this element does not have a role in the USWDS implementation (https://github.com/uswds/uswds/blob/develop/src/js/components/date-picker.js#L1457)\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      tabIndex={-1}\n      className=\"usa-date-picker__calendar__year-picker\"\n      data-testid=\"calendar-year-picker\"\n      ref={yearPickerEl}\n      onKeyDown={handleYearPickerTab}>\n      <table className=\"usa-date-picker__calendar__table\" role=\"presentation\">\n        <tbody>\n          <tr>\n            <td>\n              <button\n                type=\"button\"\n                data-testid=\"previous-year-chunk\"\n                className=\"usa-date-picker__calendar__previous-year-chunk\"\n                aria-label={`Navigate back ${YEAR_CHUNK} years`}\n                disabled={prevYearChunkDisabled}\n                onClick={handlePreviousYearChunkClick}\n                ref={prevYearChunkEl}></button>\n            </td>\n            <td colSpan={3}>\n              <table\n                className=\"usa-date-picker__calendar__table\"\n                role=\"presentation\">\n                <tbody>{listToTable(years, 3)}</tbody>\n              </table>\n            </td>\n            <td>\n              <button\n                type=\"button\"\n                data-testid=\"next-year-chunk\"\n                className=\"usa-date-picker__calendar__next-year-chunk\"\n                aria-label={`Navigate forward ${YEAR_CHUNK} years`}\n                disabled={nextYearChunkDisabled}\n                onClick={handleNextYearChunkClick}\n                ref={nextYearChunkEl}></button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\nexport default YearPicker\n"],"names":["YearPicker","date","minDate","maxDate","handleSelectYear","setStatuses","prevYearChunkEl","useRef","nextYearChunkEl","focusedYearEl","yearPickerEl","selectedYear","yearToDisplay","setYearToDisplay","useState","nextToFocus","setNextToFocus","yearToChunk","YEAR_CHUNK","prevYearChunkDisabled","isDatesYearOutsideMinOrMax","setYear","nextYearChunkDisabled","useEffect","statusStr","focusEl","fallbackFocusEl","focusedYear","yearToFocus","handleYearPickerTab","event","handleTabKey","handleKeyDownFromYear","newDisplayYear","target","_a","currentDate","newDate","cappedDate","keepDateBetweenMinAndMax","isSameYear","years","yearIndex","yearIterator","isDisabled","isSelected","isFocused","tabIndex","classes","classnames","onClick","handleMouseMoveFromYear","isIosDevice","jsx","handlePreviousYearChunkClick","adjustedYear","handleNextYearChunkClick","jsxs","listToTable"],"mappings":"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"}